/*!
 * Farbtastic: jQuery color picker plug-in v1.3u
 *
 * Licensed under the GPL license:
 *   http://www.gnu.org/licenses/gpl.html
 */
(function(a){a.fn.farbtastic=function(b){return a.farbtastic(this,b),this},a.farbtastic=function(b,c){return b=a(b).get(0),b.farbtastic||(b.farbtastic=new a._farbtastic(b,c))},a._farbtastic=function(b,c){var d=this;a(b).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var f=a(".farbtastic",b);d.wheel=a(".wheel",b).get(0),d.radius=84,d.square=100,d.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&a("*",f).each(function(){if(this.currentStyle.backgroundImage!="none"){var b=this.currentStyle.backgroundImage;b=this.currentStyle.backgroundImage.substring(5,b.length-2),a(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+b+"')"})}}),d.linkTo=function(b){typeof d.callback=="object"&&a(d.callback).unbind("keyup",d.updateValue),d.color=null;if(typeof b=="function")d.callback=b;else if(typeof b=="object"||typeof b=="string")d.callback=a(b),d.callback.bind("keyup",d.updateValue),d.callback.get(0).value&&d.setColor(d.callback.get(0).value);return this},d.updateValue=function(){this.value&&this.value!=d.color&&d.setColor(this.value)},d.setColor=function(a){var b=d.unpack(a);return d.color!=a&&b&&(d.color=a,d.rgb=b,d.hsl=d.RGBToHSL(d.rgb),d.updateDisplay()),this},d.setHSL=function(a){return d.hsl=a,d.rgb=d.HSLToRGB(a),d.color=d.pack(d.rgb),d.updateDisplay(),this},d.widgetCoords=function(b){var c=a(d.wheel).offset();return{x:b.pageX-c.left-d.width/2,y:b.pageY-c.top-d.width/2}},d.mousedown=function(b){document.dragging||(a(document).bind("mousemove",d.mousemove).bind("mouseup",d.mouseup),document.dragging=!0);var c=d.widgetCoords(b);return d.circleDrag=Math.max(Math.abs(c.x),Math.abs(c.y))*2>d.square,d.mousemove(b),!1},d.mousemove=function(a){var b=d.widgetCoords(a);return d.circleDrag?(a=Math.atan2(b.x,-b.y)/6.28,a<0&&(a+=1),d.setHSL([a,d.hsl[1],d.hsl[2]])):(a=Math.max(0,Math.min(1,-(b.x/d.square)+.5)),b=Math.max(0,Math.min(1,-(b.y/d.square)+.5)),d.setHSL([d.hsl[0],a,b])),!1},d.mouseup=function(){a(document).unbind("mousemove",d.mousemove),a(document).unbind("mouseup",d.mouseup),document.dragging=!1},d.updateDisplay=function(){var b=d.hsl[0]*6.28;a(".h-marker",f).css({left:Math.round(Math.sin(b)*d.radius+d.width/2)+"px",top:Math.round(-Math.cos(b)*d.radius+d.width/2)+"px"}),a(".sl-marker",f).css({left:Math.round(d.square*(.5-d.hsl[1])+d.width/2)+"px",top:Math.round(d.square*(.5-d.hsl[2])+d.width/2)+"px"}),a(".color",f).css("backgroundColor",d.pack(d.HSLToRGB([d.hsl[0],1,.5]))),typeof d.callback=="object"?(a(d.callback).css({backgroundColor:d.color,color:d.hsl[2]>.5?"#000":"#fff"}),a(d.callback).each(function(){this.value&&this.value!=d.color&&(this.value=d.color)})):typeof d.callback=="function"&&d.callback.call(d,d.color)},d.pack=function(a){var b=Math.round(a[0]*255),c=Math.round(a[1]*255);return a=Math.round(a[2]*255),"#"+(b<16?"0":"")+b.toString(16)+(c<16?"0":"")+c.toString(16)+(a<16?"0":"")+a.toString(16)},d.unpack=function(a){if(a.length==7)return[parseInt("0x"+a.substring(1,3))/255,parseInt("0x"+a.substring(3,5))/255,parseInt("0x"+a.substring(5,7))/255];if(a.length==4)return[parseInt("0x"+a.substring(1,2))/15,parseInt("0x"+a.substring(2,3))/15,parseInt("0x"+a.substring(3,4))/15]},d.HSLToRGB=function(a){var b,c=a[0];return b=a[1],a=a[2],b=a<=.5?a*(b+1):a+b-a*b,a=a*2-b,[this.hueToRGB(a,b,c+.33333),this.hueToRGB(a,b,c),this.hueToRGB(a,b,c-.33333)]},d.hueToRGB=function(a,b,c){return c=c<0?c+1:c>1?c-1:c,c*6<1?a+(b-a)*c*6:c*2<1?b:c*3<2?a+(b-a)*(.66666-c)*6:a},d.RGBToHSL=function(a){var b,c,d,e,f=a[0],g=a[1],h=a[2];return b=Math.min(f,Math.min(g,h)),a=Math.max(f,Math.max(g,h)),c=a-b,e=(b+a)/2,d=0,e>0&&e<1&&(d=c/(e<.5?2*e:2-2*e)),b=0,c>0&&(a==f&&a!=g&&(b+=(g-h)/c),a==g&&a!=h&&(b+=2+(h-f)/c),a==h&&a!=f&&(b+=4+(f-g)/c),b/=6),[b,d,e]},a("*",f).mousedown(d.mousedown),d.setColor("#000000"),c&&d.linkTo(c)}})(jQuery)